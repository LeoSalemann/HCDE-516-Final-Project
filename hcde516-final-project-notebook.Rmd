---
title: "The Effect of Audio Quality of a Digital Speech Transmission on Perceived Trustworthiness"
author: "Nina Chen, Christine Dicke, Leo Salemann, Cindy Xu"
output:
  html_notebook: default
  pdf_document: default
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

# Step 1: Preparing and Loading Data
## Install & Load Supporting Packages
This is for reading csv files (readr), filtering data frame rows (tidyverse/dplyr), and data conversion (lubridate), source: https://stackoverflow.com/questions/41165867/r-convert-date-from-character-to-datetime
```{r}
install.packages("readr")
install.packages("tidyverse")
install.packages("lubridate")

install.packages("ggpubr") 
install.packages("rstatix")

library(readr)
library(tidyverse)
library(lubridate)

library(ggpubr)
library(rstatix)
```

## Read Survey Data
This is to open and read the .csv file.
```{r}
dfSurveyData <- read_csv("Audio_survey_November 15, 2020_15.10.csv")

head(dfSurveyData, n=10)
```

## Cleanse Data  
* Remove extra header rows
* Rename some Columns
  - _Q13_ to _Consent_
  - _Q1_ to _AudioTopic_
  - _Q13_1_ to _Trustworthiness_
  - _Q15_1_ to _Interview_
  - _Duration (in seconds)_ to _Duration_
* Change some string columns to numeric & dates
* View results

```{r}
dfSurveyData <- dfSurveyData[-c(1,2),]

names(dfSurveyData)[names(dfSurveyData)=="Q13"]  <- "Consent"
names(dfSurveyData)[names(dfSurveyData)=="Q1"]   <- "AudioTopic"
names(dfSurveyData)[names(dfSurveyData)=="Q13_1"] <- "Trustworthiness"
names(dfSurveyData)[names(dfSurveyData)=="Q15_1"]   <- "Interview"
names(dfSurveyData)[names(dfSurveyData)=="Duration (in seconds)"] <- "Duration"

dfSurveyData$Duration       <- as.numeric(dfSurveyData$Duration)
dfSurveyData$Progress       <- as.numeric(dfSurveyData$Progress)
dfSurveyData$Trustworthiness <- as.numeric(dfSurveyData$Trustworthiness)
dfSurveyData$Interview      <- as.numeric(dfSurveyData$Interview)

dfSurveyData$StartDate <- ymd_hms(dfSurveyData$StartDate)
dfSurveyData$EndDate <- ymd_hms(dfSurveyData$EndDate)
dfSurveyData
```

## Cleanse Additional Data (i.e., filter some rows)
This is for filtering out rows in which...
* participant did not agree to terms & conditions > (Q13)
* duration is less than 35 seconds (30 sec for listening; 5 sec for answering)
* participant didn't say topic of audio clip was an interview
* _Trustworthiness_ or _Interview_ are _NA_
* Filter out rows where StartDate is before Nov 13
* Filter out survey = "Survey Preview"
* Filter for Finished = True
Display results
```{r}
dfSurveyData <- filter(dfSurveyData, !grepl("NOT",Consent))
dfSurveyData <- filter(dfSurveyData, Duration > 35) #should be 35
dfSurveyData <- filter(dfSurveyData, grepl("interview",AudioTopic))
dfSurveyData <- filter(dfSurveyData, !is.na(Trustworthiness))
dfSurveyData <- filter(dfSurveyData, !is.na(Interview))
dfSurveyData <- filter(dfSurveyData, StartDate >= as.Date("2020-11-13"))
dfSurveyData <- filter(dfSurveyData, !grepl("Survey Preview",Status))
dfSurveyData <- filter(dfSurveyData, grepl("True",Finished))
```

## Confirm Number of Records Remaining
This is to obtain the row count for the whole data set.
```{r}
nrow(dfSurveyData)
```

## Add Some Custom Columns
* _SoundClip_ identifies which clip the participant heard
* _Glitches_ counts how many glitches were the audio clip (0, 5, or 10)
* _PhoneFuzziness_ counts how many times the Audacity Telephone filter was applied (0, 1, 10)

Use mutate() and the %>%, source: https://stackoverflow.com/questions/4622060/case-statement-equivalent-in-r

```{r}

dfSurveyData <- dfSurveyData %>%
  mutate(.keep = "all", clip_type = case_when(
    .$`leo_clean` == "Yes" ~ "clean",
    .$`leo-phone-01` == "Yes" ~ "fuzz",
    .$`leo-phone-10` == "Yes" ~ "fuzz",
    .$`leo-glitch-05` == "Yes" ~ "glitch",
    .$`leo-glitch-10` == "Yes" ~ "glitch",
    TRUE ~ "unknown"
  )
)

dfSurveyData <- filter(dfSurveyData, clip_type != "unknown")

dfSurveyData <- dfSurveyData %>%
  mutate(.keep = "all", Glitches = case_when(
    .$`leo_clean` == "Yes" ~ 0,
    .$`leo-glitch-05` == "Yes" ~ 5,
    .$`leo-glitch-10` == "Yes" ~ 10,
    TRUE ~ -1
  )
)

dfSurveyData <- dfSurveyData %>%
  mutate(.keep = "all", PhoneFuzziness = case_when(
    .$`leo_clean` == "Yes" ~ 0,
    .$`leo-phone-01` == "Yes" ~ 1,
    .$`leo-phone-10` == "Yes" ~ 10,
    TRUE ~ -1
  )
)

dfSurveyData
```

#Step 2: Visualizing the Data
## Create Boxplot for Trustworthiness vs. Clip Type (Clean, Fuzzy, Glitchy)
```{r}
boxplot(Trustworthiness~clip_type, data = dfSurveyData)
```

## Create Boxplot for Willingness to Interview vs. Clip Type (Clean, Fuzzy, Glitchy)
```{r}
boxplot(Interview~clip_type, data = dfSurveyData)
```

#Step 3: Checking Assumptions (i.e., outliers, normality, homogneity of variance assumption)
This is to determine whether the data is appropriate for ANOVA and Tukey HSD, source: https://www.datanovia.com/en/lessons/anova-in-r/#check-assumptions
## Check Outliers (in Trustworthiness)
```{r}
dfSurveyData %>% group_by(clip_type) %>% identify_outliers(Trustworthiness) 
```

## Check Outliers (in Willingness to Interview)
```{r}
dfSurveyData %>% group_by(clip_type) %>% identify_outliers(Interview) 
```

## Check Normality (in Trustworthiness)
```{r}
model <- lm(Trustworthiness~clip_type, data = dfSurveyData)
ggqqplot(residuals(model))
shapiro_test(residuals(model))
```

## Check Normality (in Willingness to Interview)
```{r}
model2 <- lm(Interview~clip_type, data = dfSurveyData)
ggqqplot(residuals(model2))
shapiro_test(residuals(model2))
```

##Check Homogneity of Variance Assumption (in Trustworthiness)
```{r}
plot(model,1)
```

##Check Homogneity of Variance Assumption (in Willingness to Interview)
```{r}
plot(model2,1)
```

#Step 4: Conducting Statistical Analyses
## Conduct One Way ANOVA (Trustworthiness)
```{r}
res.aov <- aov(Trustworthiness ~ clip_type, data = dfSurveyData)
summary(res.aov)
```

## Conduct Post Hoc Test, Tukey HSD (Trustworthiness)
```{r}
TukeyHSD(res.aov)
```

## Conduct One Way ANOVA (Willingness to Interview)
```{r}
res.aov2 <- aov(Interview ~ clip_type, data = dfSurveyData)
summary(res.aov2)
```

## Conduct Post Hoc Test, Tukey HSD (Willingness to Interview)
```{r}
TukeyHSD(res.aov2)
```