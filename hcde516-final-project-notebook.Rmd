---
title: "The Effect of Audio Quality of a Digital Speech Transmission on Perceived Trustworthiness"
author: "Nina Chen, Christine Dicke, Leo Salemann, Cindy Xu"
output:
  html_notebook: default
  pdf_document: default
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

# Data Load & Prep
## Install & Load Supporting Packages
For reading csv files (readr), filtering data frame rows (tidyverse/dplyr)
Also lubridate for date convers, per good ol' stack overflow:
https://stackoverflow.com/questions/41165867/r-convert-date-from-character-to-datetime
```{r}
install.packages("readr")
install.packages("tidyverse")
install.packages("lubridate")

install.packages("tidyverse")
install.packages("ggpubr") 
install.packages("rstatix")

library(readr)
library(tidyverse)
library(lubridate)

library(tidyverse)
library(ggpubr)
library(rstatix)
```


## Read Survey Data
Open the file; have a look.
```{r}
dfSurveyData <- read_csv("Audio_survey_November 15, 2020_15.10.csv")

head(dfSurveyData, n=10)
```


## Data Cleansing  
* Remove extra header rows
* Rename some Columns
  - _Q13_ to _Consent_
  - _Q1_ to _AudioTopic_
  - _Q13_1_ to _Trustworthiness_
  - _Q15_1_ to _Interview_
  - _Duration (in seconds)_ to _Duration_
* Change some string columns to numeric & dates
* View results
```{r}
dfSurveyData <- dfSurveyData[-c(1,2),]

names(dfSurveyData)[names(dfSurveyData)=="Q13"]  <- "Consent"
names(dfSurveyData)[names(dfSurveyData)=="Q1"]   <- "AudioTopic"
names(dfSurveyData)[names(dfSurveyData)=="Q13_1"] <- "Trustworthiness"
names(dfSurveyData)[names(dfSurveyData)=="Q15_1"]   <- "Interview"
names(dfSurveyData)[names(dfSurveyData)=="Duration (in seconds)"] <- "Duration"

dfSurveyData$Duration       <- as.numeric(dfSurveyData$Duration)
dfSurveyData$Progress       <- as.numeric(dfSurveyData$Progress)
dfSurveyData$Trustworthiness <- as.numeric(dfSurveyData$Trustworthiness)
dfSurveyData$Interview      <- as.numeric(dfSurveyData$Interview)

dfSurveyData$StartDate <- ymd_hms(dfSurveyData$StartDate)
dfSurveyData$EndDate <- ymd_hms(dfSurveyData$EndDate)
dfSurveyData
```


## More Cleansing - Filter some Rows
Filter out rows where ...
* participant did not agree to terms & conditions. (Q13).
* duration is less than 35 seconds (30 sec for listening; 5 sec for answering)
* participant didn't say topic of audio clip was an interview. 
* _Trustworthiness_ or _Interview_ are _NA_
* Filter out rows where StartDate is before Nov 13
* Filter out survey = "Survey Preview"
* Filter for Finished = True
Display results.
```{r}
dfSurveyData <- filter(dfSurveyData, !grepl("NOT",Consent))
dfSurveyData <- filter(dfSurveyData, Duration > 35) #should be 35
dfSurveyData <- filter(dfSurveyData, grepl("interview",AudioTopic))
dfSurveyData <- filter(dfSurveyData, !is.na(Trustworthiness))
dfSurveyData <- filter(dfSurveyData, !is.na(Interview))
dfSurveyData <- filter(dfSurveyData, StartDate >= as.Date("2020-11-13"))
dfSurveyData <- filter(dfSurveyData, grepl("interview",AudioTopic))
dfSurveyData <- filter(dfSurveyData, !grepl("Survey Preview",Status))
dfSurveyData <- filter(dfSurveyData, grepl("True",Finished))
dfSurveyData
```


## Done filtering, how many rows left?
Get the row count for the whole dataset.
```{r}
nrow(dfSurveyData)
```


## Add Some Custom columns
* _SoundClip_ identifies which clip the particpant heard
* _Glitches_ counts how many glitches were the audio clip (0, 5, or 10)
* _PhoneFuzziness_ counts how many times the Audacity Telephone filter was applied (0, 1, 10)

Use mutate() and the %>% per this cool trick from Stack overflow
https://stackoverflow.com/questions/4622060/case-statement-equivalent-in-r

```{r}

dfSurveyData <- dfSurveyData %>%
  mutate(.keep = "all", clip_type = case_when(
    .$`leo_clean` == "Yes" ~ "clean",
    .$`leo-phone-01` == "Yes" ~ "fuzz",
    .$`leo-phone-10` == "Yes" ~ "fuzz",
    .$`leo-glitch-05` == "Yes" ~ "glitch",
    .$`leo-glitch-10` == "Yes" ~ "glitch",
    TRUE ~ "unknown"
  )
)

dfSurveyData <- filter(dfSurveyData, clip_type != "unknown")

dfSurveyData <- dfSurveyData %>%
  mutate(.keep = "all", Glitches = case_when(
    .$`leo_clean` == "Yes" ~ 0,
    .$`leo-glitch-05` == "Yes" ~ 5,
    .$`leo-glitch-10` == "Yes" ~ 10,
    TRUE ~ -1
  )
)

dfSurveyData <- dfSurveyData %>%
  mutate(.keep = "all", PhoneFuzziness = case_when(
    .$`leo_clean` == "Yes" ~ 0,
    .$`leo-phone-01` == "Yes" ~ 1,
    .$`leo-phone-10` == "Yes" ~ 10,
    TRUE ~ -1
  )
)

dfSurveyData
```

# Do Some Plots
## Trusworthiness vs. Clip Type (Clean, Fuzzy, Glitchy)
```{r}
boxplot(Trustworthiness~clip_type, data = dfSurveyData)
```
## Willingess to Interview vs. Clip Type (Clean, Fuzzy, Glitchy)
```{r}
boxplot(Interview~clip_type, data = dfSurveyData)
```

# Find an Appropriate Statiscial Test 
According to Field, we have ....

* **one continuous outcome variable** Treat Trustworthiness and Would-you-Interview separately, each are a 0.0-10.0 scale.

* **one categorical predictor with more than 2 categories, which are the same entities.** Clip Type is one of {clean, fuzzy, glitchy}

... So Field prescribes a **One-Way Repeated Measures Anova**

Following the procedures from Data Novia at https://www.datanovia.com/en/lessons/repeated-measures-anova-in-r/  

# Do a One-Way Repeated Measures Anova
## Check for outliers
```{r}
dfSurveyData %>% group_by(clip_type) %>% identify_outliers(Trustworthiness) 
```


Four outliers in *Trusworthiness*; none extereme.

Try *Interview*
```{r}
dfSurveyData %>% group_by(clip_type) %>% identify_outliers(Interview) 
```



No outliers at all.

# Check for Normality with a QQ plot
```{r}
ggqqplot(dfSurveyData, "Trustworthiness", facet.by = "clip_type")
```
Looks like  *clean* follows a normal distribution, *glitch* mostly does; and *fuzz* is almost there.

Now check *Interview*

```{r}
ggqqplot(dfSurveyData, "Interview", facet.by = "clip_type")
```
Looks like *Would you Continue Interview* is normal for all clip types.

# Split the data so we can do independent t-tests
* dataset will have clean & fuzz in it; the other will have clean & glitch
```{r}
dfGlitches <- filter(dfSurveyData, dfSurveyData$Glitches >= 0)
dfGlitches
```
```{r}
dfPhoneFuzz <- filter(dfSurveyData, dfSurveyData$PhoneFuzziness >= 0)
dfPhoneFuzz
```
# Run some T-Tests
## T-test on the effect of glitchiness on Trustworthiness 
```{r}
res.glitches.trust <- t.test(Trustworthiness~clip_type, data = dfGlitches, var.equal = TRUE)
res.glitches.trust
```
The p-value is 0.03114, less than the 5% threshold, so we can conclude that glitches significantly degrade perceived trustworthiness of the person speaking.

## T-test on the effect of glitchiness on Willingness to Proceed with  Interview
```{r}
res.glitches.interview <- t.test(Interview~clip_type, data = dfGlitches, var.equal = TRUE)
res.glitches.interview
```

The p-value is 0.003221, less than the 5% threshold, so we can conclude that glitches significantly degrade the listener's willingness to continue with the interview. 


## T-test on the effect of phone fuzz on Trusworthiness 
```{r}
res.fuzz.trust <- t.test(Trustworthiness~clip_type, data = dfPhoneFuzz, var.equal = TRUE)
res.fuzz.trust
```
The p-value is 0.8249, more than the 5% threshold, so we CANNOT claim that phone fuzz signficantly degrades perceived trustworthiness of the person speaking. 


## T-test on the effect of phone fuzz on Willingness to Proceed with Interview
```{r}
res.fuzz.interview <- t.test(Interview~clip_type, data = dfPhoneFuzz, var.equal = TRUE)
res.fuzz.interview
```


The p-value is 0.2393, more than the 5% threshold, so we CANNOT conclude that phone fuzz significantly degrades perceived trustworthiness of the person speaking. 


# BELOW HERE IS JUNK(for now)

# Run the ANOVA Tests
```{r}
dfSurveyData$id <- seq.int(nrow(dfSurveyData))
# dfSurveyData$id <- tibble::rowid_to_column(dfSurveyData, "id")
# dfSurveyData

res.aov.Trustworthiness <- anova_test(data = dfSurveyData, dv = Trustworthiness, wid = id, within = clip_type)
get_anova_table(res.aov.Trustworthiness)
```

